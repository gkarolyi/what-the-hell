<% cast_thread = Thread.new { CastMatcher.call(@query) } %>
<% movies_thread = Thread.new { MovieInfo.call(@query) } %>

<div class="background-gradient">

    <div class="container container-home-page">
        <% if @query.empty? %>
            <!-- if there isn't any search in the parameters -->
            <%= render "shared/text/main_title" %>
            
            <div> 
                <%= render "shared/forms/movie_input" %>
                <%= render "shared/forms/image_upload" %>
            </div>


                <p class="tag-line">
                    Write down a movie name or upload an actor's picture and we'll find their name for you !
                </p>

        <% else %>
                    <!-- if there already has been movie input -->
                    <% @movies = movies_thread.value %>
                    <% recommendations_thread = Thread.new { MovieRecommendation.call(@movies.last) } %>
                    <div id="movie-card-section" data-cable-id="<%= params[:search][:queries] %>">
                        <%= render "shared/cards/movie_cards" %>
                    </div>
            
                    <%= render 'shared/forms/movie_input' %>

                    <div id="cast-subtitle-section">
                        <h2>Gathering your results...</h2>
                    </div>
                    
                    <% @cast = cast_thread.value %>
                    <div id="cast-section" data-cable-id="<%= params[:search][:queries] %>">
                        <%= render 'shared/navigation/cast_loading' %>
                        <%= render 'shared/cards/cast_cards' %>
                    </div>

                    <% @recommendations = recommendations_thread.value %>
                    <% if @recommendations %>
                        <div id="movie-recommendation-section" data-cable-id="<%= params[:search][:queries] %>">
                            <%= render 'shared/cards/movie_recommendations' %>
                        </div>
                    <% end %>

            <% if @query.count > 1 %>
              <%= render 'shared/navigation/footer' %>
            <% end %>

        <% end %>
    </div>

    <% if @query.empty? %>
        <div class="cover"></div>
    <% end %>

</div>
